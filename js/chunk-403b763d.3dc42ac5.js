(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-403b763d"],{"9d29":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"m-archive-box"},[e.isLogin?t("div",{staticClass:"m-bucket"},[t("common-header",{on:{filterImperceptibly:e.filterImperceptibly,filterMeta:e.filterMeta,search:e.onSearch}}),t("el-alert",{attrs:{title:"自用宏将会被设置为仅私有，不论私有或公开游戏内均可以云端加载。",type:"info","show-icon":""}}),e.data&&e.data.length?t("div",{staticClass:"m-archive-list"},[t("ul",{staticClass:"u-list"},e._l(e.data,(function(a,i){return t("list-item",{key:i+a,attrs:{item:a,order:e.order},on:{loadMacro:e.loadMacro}})})),1)]):t("el-alert",{staticClass:"m-archive-null",attrs:{title:"没有找到相关条目",type:"info",center:"","show-icon":""}}),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.hasNextPage,expression:"hasNextPage"}],staticClass:"m-archive-more",attrs:{type:"primary",loading:e.loading,icon:"el-icon-arrow-down"},on:{click:e.appendPage}},[e._v("加载更多")]),t("el-pagination",{staticClass:"m-archive-pages",attrs:{background:"",layout:"total, prev, pager, next, jumper","hide-on-single-page":!0,"page-size":e.per,total:e.total,"current-page":e.page},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"current-change":e.changePage}})],1):t("div",{staticClass:"m-archive-noright"},[t("div",{staticClass:"u-tip-login el-alert el-alert--warning is-light"},[t("i",{staticClass:"el-alert__icon el-icon-warning"}),t("span",[e._v(" 使用私有宏仓库，请先 "),t("a",{attrs:{href:e.login_url}},[e._v("登录")])])])]),t("el-drawer",{staticClass:"m-macro-drawer",attrs:{title:"云端宏",visible:e.drawer,"append-to-body":!0},on:{"update:visible":function(t){e.drawer=t}}},[t("div",{staticClass:"u-box"},[t("h2",{staticClass:"u-title"},[e._v(e._s(e.drawer_title))]),t("macro",{attrs:{ctx:e.drawer_content,name:e.drawer_title,id:e.drawer_id}}),t("a",{staticClass:"u-skip el-button el-button--primary",attrs:{href:e.drawer_link}},[t("i",{staticClass:"el-icon-copy-document"}),e._v(" 查看详情 ")])],1)])],1)},r=[],n=a("c7eb"),s=a("3835"),o=a("1da1"),l=a("ade3"),c=(a("99af"),a("caad"),a("14d9"),a("b0c0"),a("b64b"),a("d3b7"),a("ac1f"),a("2532"),a("841c"),a("498a"),a("483c")),u=a("c9d2"),d=a("65c2"),h=a("e08c"),p=a("fc24"),g=a("e635"),f={name:"Bucket",props:[],data:function(){return{loading:!1,data:[],page:1,per:10,total:1,pages:1,number_queries:["per","page"],subtype:"",order:"update",mark:"",client:this.$store.state.client,search:"",lang:"",drawer:!1,drawer_title:"",drawer_content:"",drawer_link:"",drawer_id:"",langs:{cn:"简体中文",tr:"繁體中文"},uid:u["a"].getInfo().uid,isLogin:u["a"].isLogin()}},computed:{hasNextPage:function(){return this.pages>1&&this.page<this.total},query:function(){return{subtype:this.subtype,order:this.order,mark:this.mark,client:this.client,search:this.search,lang:this.lang}},pg_queries:function(){return{page:this.page,per:this.per}},reset_queries:function(){return[this.subtype,this.search]},login_url:function(){return d["__Links"].account.login+"?redirect="+location.href}},methods:{buildQuery:function(e){e&&(this.page+=1);var t={per:this.per,page:this.page};for(var a in this.query)void 0!==this.query[a]&&""!==this.query[a]&&null!==this.query[a]&&("search"==a?t.search=this.query.search.trim():t[a]=this.query[a]);return t},onSearch:function(e){this.search=e},loadData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=this.buildQuery(t);return console.log("[cms-list]","<loading data>",a),this.loading=!0,Object(c["c"])(a).then((function(a){var i,r,n,s,o,l,c,u;t?e.data=e.data.concat(null===(o=a.data)||void 0===o||null===(l=o.data)||void 0===l?void 0:l.list):e.data=null===(c=a.data)||void 0===c||null===(u=c.data)||void 0===u?void 0:u.list;e.total=null===(i=a.data)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.total,e.pages=null===(n=a.data)||void 0===n||null===(s=n.data)||void 0===s?void 0:s.pages})).finally((function(){e.loading=!1}))},replaceRoute:function(e){return this.$router.push({name:this.$route.name,query:Object.assign({},this.$route.query,e)}).then((function(){window.scrollTo(0,0)})).catch((function(e){}))},filterMeta:function(e){this.replaceRoute(Object(l["a"])(Object(l["a"])({},e["type"],e["val"]),"page",1))},filterImperceptibly:function(e){this[e["type"]]=e["val"]},changePage:function(e){this.loadData(),this.replaceRoute({page:e})},appendPage:function(){this.loadData(!0)},loadMacro:function(e){var t=this;return Object(o["a"])(Object(n["a"])().mark((function a(){var i,r,o,l,c,u,d,h;return Object(n["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=Object(s["a"])(e,4),r=i[0],o=i[1],l=i[2],c=i[3],5!=c.visible){a.next=9;break}return a.next=4,isFans(c.post_author);case 4:if(d=a.sent,h=null===(u=d.data)||void 0===u?void 0:u.data,h){a.next=9;break}return t.$message.warning("该宏设置为粉丝可见，如需查看请关注作者"),a.abrupt("return");case 9:t.drawer=!0,t.drawer_title=r+"#"+o.name,t.drawer_content=o.macro,t.drawer_link="/macro/"+l+"?tab="+o.name,t.drawer_id=l;case 14:case"end":return a.stop()}}),a)})))()}},watch:{"$route.query":{deep:!0,immediate:!0,handler:function(e){if(Object.keys(e).length)for(var t in console.log("[cms-list]","<route query change>",e),e)this.number_queries.includes(t)?this[t]=~~e[t]:this[t]=e[t]}},reset_queries:{deep:!0,handler:function(){console.log("[cms-list]","<reset page>"),this.page=1}},query:{deep:!0,immediate:!0,handler:function(e){console.log("[cms-list]","<request query change>",e),this.isLogin&&this.loadData()}}},components:{listItem:p["a"],macro:h["a"],CommonHeader:g["a"]}},m=f,v=(a("da2f"),a("2877")),b=Object(v["a"])(m,i,r,!1,null,null,null);t["default"]=b.exports},da2f:function(e,t,a){"use strict";a("f29d")},f29d:function(e,t,a){}}]);